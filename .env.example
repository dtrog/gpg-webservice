# GPG Webservice Suite - Root Environment Configuration
# ========================================================
# Copy this file to .env and customize for your environment
#
# This root .env file contains shared configuration for all services.
# Individual services also have their own .env files that inherit from this.

# =============================================================================
# SERVICE PORTS
# =============================================================================

# Flask REST API
FLASK_PORT=5555

# MCP Server
MCP_PORT=3000

# Dashboard (maps to internal port 80)
DASHBOARD_PORT=8080

# =============================================================================
# INTER-SERVICE COMMUNICATION
# =============================================================================

# How MCP server connects to REST API (internal Docker network)
GPG_API_BASE=http://gpg-webservice:5555

# How Dashboard connects to REST API (can be overridden for external access)
API_URL=http://localhost:5555

# =============================================================================
# COMMON CONFIGURATION
# =============================================================================

# Environment Mode
ENVIRONMENT=development  # development, testing, production

# Logging
LOG_LEVEL=INFO  # DEBUG, INFO, WARNING, ERROR, CRITICAL
LOG_FORMAT=json  # json or text

# =============================================================================
# SECURITY (CRITICAL - REQUIRED)
# =============================================================================

# ⚠️  CRITICAL: These variables are REQUIRED for the service to start
# ⚠️  Generate secure values before first run!
#
# Generate automatically with:
#   cd gpg-webservice-rest && ./scripts/generate-secrets.sh
#
# Or generate manually:
#   openssl rand -base64 32

# Service Key Passphrase (protects internal GPG keys)
SERVICE_KEY_PASSPHRASE=CHANGE_THIS_BEFORE_RUNNING

# Flask Secret Key (protects sessions)
SECRET_KEY=CHANGE_THIS_BEFORE_RUNNING

# =============================================================================
# DATABASE
# =============================================================================

# Development (SQLite - stored in gpg-webservice-rest/)
DATABASE_URL=sqlite:///gpg_users.db

# Production (PostgreSQL recommended)
# DATABASE_URL=postgresql://user:password@host:5432/gpg_webservice

# Production (MySQL alternative)
# DATABASE_URL=mysql://user:password@host:3306/gpg_webservice

# =============================================================================
# DOCKER VOLUMES
# =============================================================================

# Database location (when using SQLite)
# Stored in: ./gpg-webservice-rest/gpg_users.db
# In Docker: Mounted as volume

# GPG temporary directories
# Host: /tmp/gpg-docker (for operations)
# Container: /tmp/gnupg

# =============================================================================
# ADMIN ACCESS CONTROL
# =============================================================================

# Session-key based admins (for AI agents with 1-hour expiring keys)
# Comma-separated list of usernames that can use admin endpoints
# These users authenticate with X-API-KEY + X-Username headers
# Example: ADMIN_USERNAMES=alice,bob,agent_manager
ADMIN_USERNAMES=

# GPG-based admins (for human administrators with non-expiring auth)
# JSON object mapping usernames to PGP public keys
# These admins sign challenges and use X-Admin-Token header (24h validity)
#
# To set up GPG-based admin authentication:
# 1. Generate or export your GPG public key:
#    gpg --armor --export your-email@example.com > admin-pubkey.asc
#
# 2. Convert to single-line JSON (escape newlines as \\n):
#    cat admin-pubkey.asc | jq -Rs '{administrator: .}' | jq -c
#
# 3. Set in .env (must be valid JSON, newlines as \\n):
#    ADMIN_GPG_KEYS='{"administrator":"-----BEGIN PGP PUBLIC...\\n..."}'
#
# 4. Authenticate via:
#    python scripts/admin_gpg_auth.py login administrator
#
# Example (use your actual public key):
# ADMIN_GPG_KEYS={"administrator":"-----BEGIN PGP PUBLIC KEY BLOCK-----\\n..."}
ADMIN_GPG_KEYS={}

# =============================================================================
# RATE LIMITING
# =============================================================================

RATE_LIMIT_AUTH_REQUESTS=5   # Authentication attempts per window
RATE_LIMIT_AUTH_WINDOW=60    # Window in seconds
RATE_LIMIT_API_REQUESTS=30   # API calls per window
RATE_LIMIT_API_WINDOW=60     # Window in seconds

# =============================================================================
# FILE UPLOADS
# =============================================================================

MAX_FILE_SIZE_MB=10
MAX_SIGNATURE_SIZE_MB=1
MAX_CONTENT_LENGTH=16777216  # 16MB in bytes

# =============================================================================
# GPG SETTINGS
# =============================================================================

GPG_KEY_LENGTH=3072  # 2048, 3072, or 4096
GPG_KEY_TYPE=RSA

# =============================================================================
# NOTES
# =============================================================================
#
# 1. BEFORE FIRST RUN:
#    - Copy this file: cp .env.example .env
#    - Generate secrets: cd gpg-webservice-rest && ./scripts/generate-secrets.sh
#    - Or run automated setup: ./setup.sh
#
# 2. SECURITY:
#    - NEVER commit .env to version control
#    - Use strong random values for SERVICE_KEY_PASSPHRASE and SECRET_KEY
#    - Rotate secrets periodically in production
#
# 3. PRODUCTION:
#    - Use PostgreSQL instead of SQLite
#    - Set ENVIRONMENT=production
#    - Enable HTTPS via reverse proxy
#    - Set up proper monitoring and logging
#
# 4. INDIVIDUAL SERVICE CONFIG:
#    - gpg-webservice-rest/.env - REST API specific config
#    - This root .env provides defaults that can be overridden
#
# =============================================================================
