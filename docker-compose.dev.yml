# GPG Webservice - Development Overrides
# =======================================
# Use this file for development with hot-reload and debugging
#
# Usage:
#   docker-compose -f docker-compose.yml -f docker-compose.dev.yml up -d
#
# This overrides the main docker-compose.yml for development purposes

version: '3.8'

services:
  # =============================================================================
  # Flask REST API - Development Overrides
  # =============================================================================
  gpg-webservice:
    environment:
      - FLASK_ENV=development
      - FLASK_DEBUG=1
      - DEBUG=true
      - LOG_LEVEL=DEBUG
    volumes:
      # Mount source code for hot-reload
      - ./gpg-webservice-rest:/app:delegated
      # Exclude Python cache
      - /app/__pycache__
      - /app/.pytest_cache
    # Expose debug port for remote debugging (optional)
    ports:
      - "${FLASK_PORT:-5555}:${FLASK_PORT:-5555}"
      - "5678:5678"  # Python debugger port (debugpy)
    command: python app.py  # Use built-in Flask dev server

  # =============================================================================
  # MCP Server - Development Overrides
  # =============================================================================
  gpg-mcp-server:
    environment:
      - NODE_ENV=development
      - LOG_LEVEL=debug
    volumes:
      # Mount source code for hot-reload (if using nodemon)
      - ./gpg-webservice-mcp/src:/app/src:delegated
      - /app/node_modules
    # Expose debug port for Node.js debugging
    ports:
      - "${MCP_PORT:-3000}:${MCP_PORT:-3000}"
      - "9229:9229"  # Node.js inspector port

  # =============================================================================
  # Dashboard - Development Overrides
  # =============================================================================
  gpg-dashboard:
    volumes:
      # Mount source for live editing
      - ./gpg-webservice-dashboard/index.html:/usr/share/nginx/html/index.html:ro
      - ./gpg-webservice-dashboard/js:/usr/share/nginx/html/js:ro
      - ./gpg-webservice-dashboard/css:/usr/share/nginx/html/css:ro
    environment:
      - NGINX_DEBUG=1

# =============================================================================
# DEVELOPMENT NOTES
# =============================================================================
#
# Hot Reload:
#   - Flask: Auto-reloads on file changes (FLASK_DEBUG=1)
#   - Node.js: Requires nodemon in package.json
#   - Nginx: Changes to HTML/CSS/JS reflect immediately
#
# Debugging:
#   - Flask: Use VS Code Python debugger on port 5678
#   - Node.js: Use Chrome DevTools or VS Code on port 9229
#
# Performance:
#   - Volume mounts use :delegated for better performance on Mac/Windows
#   - Python cache excluded to prevent stale imports
#
# =============================================================================
