# Docker Compose Override for Local Development (HTTP only)
# ===========================================================
# Usage: docker compose -f docker-compose.yml -f docker-compose.local.yml up -d
#
# This removes TLS/HTTPS from internal services for easier local testing.
# Services run on HTTP internally (no self-signed cert warnings).

services:
  gpg-webservice-rest:
    environment:
      - TLS_CERT=
      - TLS_KEY=
    volumes:
      # Keep only database and GPG temp, remove cert mounts
      - ./gpg-webservice-rest/gpg_users.db:/app/gpg_users.db
      - gpg-temp:/tmp/gnupg
    healthcheck:
      test: ["CMD", "python", "-c", "import urllib.request; urllib.request.urlopen('http://localhost:${FLASK_PORT:-5555}/openai/function_definitions')"]

  gpg-webservice-mcp:
    environment:
      - GPG_API_BASE=http://gpg-webservice-rest:5555
      - NODE_TLS_REJECT_UNAUTHORIZED=
      - TLS_CERT=
      - TLS_KEY=
    volumes: []

  gpg-webservice-dashboard:
    environment:
      - API_URL=http://localhost:5555
    volumes:
      # Use static HTTP nginx config
      - ./gpg-webservice-dashboard/nginx.conf.static:/etc/nginx/conf.d/default.conf:ro
